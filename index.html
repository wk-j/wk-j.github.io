<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>wk&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="wk's blog">
<meta property="og:url" content="http://wk-j.gihub.io/index.html">
<meta property="og:site_name" content="wk's blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="wk's blog">
<meta name="twitter:description">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-72419467-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body>
  <div id="container">
    <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
      <a id="logo" class="logo" href="/"></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://wk-j.gihub.io"></form>
        </div>
      </nav>
    </div>
  </div>
</header>
    <section id="main" class="outer">
      <article id="post-csharp-create-instance-with-lambda" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/13/csharp-create-instance-with-lambda/">สร้าง Instance ด้วย Lambda Expression</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2016/02/13/csharp-create-instance-with-lambda/" class="article-date">
  <time datetime="2016-02-13T09:30:31.000Z" itemprop="datePublished">2016-02-13</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Note"><a href="#Note" class="headerlink" title="Note"></a>Note</h2><p>สามารถสร้าง instance ด้วย lambda expression โดยไม่ต้องสนใจ accessibility ของคลาส</p>
<h2 id="u0E15_u0E31_u0E27_u0E2D_u0E22_u0E48_u0E32_u0E07"><a href="#u0E15_u0E31_u0E27_u0E2D_u0E22_u0E48_u0E32_u0E07" class="headerlink" title="ตัวอย่าง"></a>ตัวอย่าง</h2><p>ตัวอย่างนี้เป็นการใช้ expression ที่ประกาศไว้ใน namespace <code>System.Linq.Expression</code></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Linq.Expressions</span><br><span class="line"><span class="keyword">class</span> <span class="title">C</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">C</span>(<span class="params"></span>)</span>&#123; Console.WriteLine(<span class="string">"init.."</span>); &#125;</span><br><span class="line">&#125;</span><br><span class="line">Expression&lt;Func&lt;C&gt;&gt; e =</span><br><span class="line">    Expression.Lambda&lt;Func&lt;C&gt;&gt;(Expression.New(<span class="keyword">typeof</span>(C)),</span><br><span class="line">        Enumerable.Empty&lt;ParameterExpression&gt;());</span><br><span class="line">Func&lt;C&gt; f = e.Compile();</span><br></pre></td></tr></table></figure>
<p>ในโค้ดมีการใช้ <code>Expression.New</code> เพื่อสร้าง instance ของคลาส <code>C</code> คำสั่งนี้จะไม่มีการเช็ค accessibility ของคลาสโดยสังเกตจากการเรียกฟังก์ชั่น <code>f</code> ที่ได้จากการคอมไพล์ expression จะไม่เกิด error เกี่ยวกับ protection level ทั้งที่ constructor ของคลาส <code>C</code> ประกาศเป็น <code>private</code></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c1 = f();</span><br></pre></td></tr></table></figure>
<p>ผลลัพธ์</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">init..</span><br></pre></td></tr></table></figure>
<p>จะต่างจากการสร้าง instance โดยใช้ <code>new</code> ซึ่ง compiler จะเช็ด accessibility ของคลาสเสมอ</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c2 = <span class="keyword">new</span> C();</span><br></pre></td></tr></table></figure>
<p>ผลลัพท์ คือ โค้ดไม่สามารถ compile โดยจะแสดง message ดังนี้</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">1</span>,<span class="number">11</span>): error CS0122: `C.C()<span class="string">' is inaccessible due to its protection level</span><br><span class="line">(2,13): (Location of the symbol related to previous error)</span></span><br></pre></td></tr></table></figure>
      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cs/">cs</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <article id="post-fsharp-reduce-and-fold" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/07/fsharp-reduce-and-fold/">ฟังก์ชัน Fold กับ Reduce</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2016/02/07/fsharp-reduce-and-fold/" class="article-date">
  <time datetime="2016-02-07T09:30:31.000Z" itemprop="datePublished">2016-02-07</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p> ใน F# มีฟังก์ชั่นที่ใช้สำหรับ aggregate ข้อมูลคล้ายกับ <code>Aggregate</code> ของ LINQ คือ <code>fold</code> กับ <code>reduce</code></p>
<h2 id="Aggregate__u0E43_u0E19_C_23"><a href="#Aggregate__u0E43_u0E19_C_23" class="headerlink" title="Aggregate ใน C#."></a>Aggregate ใน C#.</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> data = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line"><span class="keyword">var</span> sum = data.Aggregate(<span class="number">0</span>, (acc,x) =&gt; acc + x); <span class="comment">// sum = 6</span></span><br><span class="line"><span class="keyword">var</span> pro = data.Aggregate(<span class="number">1</span>, (acc,x) =&gt; acc * x); <span class="comment">// pro = 6</span></span><br></pre></td></tr></table></figure>
<h2 id="Fold"><a href="#Fold" class="headerlink" title="Fold"></a>Fold</h2><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> System.Linq</span><br><span class="line"><span class="keyword">let</span> data = [|<span class="number">1</span>;<span class="number">2</span>;<span class="number">3</span>|]</span><br><span class="line"><span class="keyword">let</span> sum = Array.fold (<span class="keyword">fun</span> acc x -&gt; acc + x) <span class="number">0</span> data <span class="comment">// sum = 6</span></span><br><span class="line"><span class="keyword">let</span> pro = Array.fold (<span class="keyword">fun</span> acc x -&gt; acc * x) <span class="number">1</span> data <span class="comment">// pro = 6</span></span><br></pre></td></tr></table></figure>
<p>ฟังก์ชั่น <code>fold</code> รับ parameter ทั้งหมด 3 ตัว คือ</p>
<ul>
<li><em>folder</em>  คือ ฟังก์ชันสำหรับ transform หรือ update state</li>
<li><em>state</em> คือ initial value หรือค่าเริ่มต้นที่จะถูกใช้ในฟังก์ชัน <em>folder</em></li>
<li><em>input</em> คือ ข้อมูลที่ต้องการ process</li>
</ul>
<h2 id="Reduce"><a href="#Reduce" class="headerlink" title="Reduce"></a>Reduce</h2><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> data = [<span class="number">1</span>;<span class="number">2</span>;<span class="number">3</span>]</span><br><span class="line"><span class="keyword">let</span> empty = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sum1 = List.reduce(<span class="keyword">fun</span> acc x -&gt; acc + x) data   <span class="comment">// sum1 = 6</span></span><br><span class="line"><span class="keyword">let</span> sum2 = List.reduce(<span class="keyword">fun</span> acc x -&gt; acc + x) empty  <span class="comment">// ERROR: The input list was empty.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sum3 = List.fold(<span class="keyword">fun</span> acc x -&gt; acc + x) <span class="number">0</span> data   <span class="comment">// sum3 = 6</span></span><br><span class="line"><span class="keyword">let</span> sum4 = List.fold(<span class="keyword">fun</span> acc x -&gt; acc + x) <span class="number">0</span> empty  <span class="comment">// sum4 = 0</span></span><br></pre></td></tr></table></figure>
<p>ฟังก์ชั่น <code>reduce</code> จะคล้ายกับ <code>fold</code> ต่างกันที่เราไม่สามารถใส่ state หรือ initial value แบบ explicit ได้ <code>fold</code> จึงต้องดึง element ตัวแรกของ input เป็น initial value เสมอ ทำให้เกิดข้อจำกัด คือ ข้อมูล input จำเป็นต้องมีอย่างน้อย 1 element มิฉะนั้นจะเกิด error <code>System.ArgumentException: The input list was empty</code></p>
<p>ความแตกต่างอีกข้อคือ initial value ที่ใสในฟังก์ชั่น <code>fold</code> สามารถเป็น type ใดก็ได้ ส่งผลให้ลัพท์สุดท้ายไม่จำเป็นต้องเป็น type เดียวกับ input element จะแตกต่างจาก <code>reduce</code> ที่ output ต้องเป็น type เดียวกับ input element เสมอ</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span> .. <span class="number">3</span>] |&gt; List.fold (<span class="keyword">fun</span> str n -&gt; str + <span class="string">","</span> + (string n)) <span class="string">""</span> <span class="comment">// ,1,2,3</span></span><br></pre></td></tr></table></figure>
<p>Links</p>
<ul>
<li><a href="http://stackoverflow.com/questions/9055837/difference-between-fold-and-reduce" target="_blank" rel="external">http://stackoverflow.com/questions/9055837/difference-between-fold-and-reduce</a></li>
</ul>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/fs/">fs</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <article id="post-fsharp-entity-framework-code-first" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/04/fsharp-entity-framework-code-first/">เขียน Entity Framework Code First ด้วย F#</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2016/02/04/fsharp-entity-framework-code-first/" class="article-date">
  <time datetime="2016-02-04T16:19:15.000Z" itemprop="datePublished">2016-02-04</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Dependencies"><a href="#Dependencies" class="headerlink" title="Dependencies"></a>Dependencies</h2><p>ตัวอย่างนี้จะใช้ EF เชื่อมกับฐานข้อมูล PostgreSQL ซึ่งจะต้องใช้ dependencies สองตัว คือ <code>EntityFramework</code> และ <code>Npgsql.EntityFramework</code> สามารถติดตั้งผ่าน Package Manager Console ดังนี้</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Install-Package EntityFramewok</span><br><span class="line">Install-Package Npgsql.EntityFramework</span><br></pre></td></tr></table></figure>
<h2 id="Config"><a href="#Config" class="headerlink" title="Config"></a>Config</h2><p>ในไฟล์ <code>App.config</code> ต้องเพิ่มแท็ก <code>configSections</code> <code>system.Data</code> <code>entityFramework</code> และ <code>connectionString</code> โดยชื่อ connection ในที่นี่จะใช้คำว่า <code>production</code> พร้อมระบุรายละเอียดของฐานข้อมูลไว้ใน attribute ชื่อ <code>connectionString</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">configSections</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">section</span> <span class="attribute">name</span>=<span class="value">"entityFramework"</span> <span class="attribute">type</span>=<span class="value">"System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=6.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"</span> <span class="attribute">requirePermission</span>=<span class="value">"false"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">configSections</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">system.data</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">DbProviderFactories</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">remove</span> <span class="attribute">invariant</span>=<span class="value">"Npgsql"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">add</span> <span class="attribute">name</span>=<span class="value">"Npgsql Data Provider"</span> <span class="attribute">invariant</span>=<span class="value">"Npgsql"</span> <span class="attribute">support</span>=<span class="value">"FF"</span> <span class="attribute">description</span>=<span class="value">".Net Framework Data Provider for Postgresql"</span> <span class="attribute">type</span>=<span class="value">"Npgsql.NpgsqlFactory, Npgsql"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">DbProviderFactories</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">system.data</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">entityFramework</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">defaultConnectionFactory</span> <span class="attribute">type</span>=<span class="value">"System.Data.Entity.Infrastructure.SqlConnectionFactory, EntityFramework"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">providers</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">provider</span> <span class="attribute">invariantName</span>=<span class="value">"System.Data.SqlClient"</span> <span class="attribute">type</span>=<span class="value">"System.Data.Entity.SqlServer.SqlProviderServices, EntityFramework.SqlServer"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">provider</span> <span class="attribute">invariantName</span>=<span class="value">"Npgsql"</span> <span class="attribute">type</span>=<span class="value">"Npgsql.NpgsqlServices, Npgsql.EntityFramework"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">providers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">entityFramework</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">connectionStrings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">add</span> <span class="attribute">name</span>=<span class="value">"production"</span> <span class="attribute">providerName</span>=<span class="value">"Npgsql"</span> <span class="attribute">connectionString</span>=<span class="value">"Server=192.168.0.xxx;Port=5432;Database=DbName; User Id=xxx;Password=xxx;"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">connectionStrings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="Models"><a href="#Models" class="headerlink" title="Models"></a>Models</h2><p>EF Code First ต้องประกาศ Entity class ในตัวอย่างนี้จะมีเพียงคลาสเดียว คือ <code>QUser</code> ซึ่ง extend จาก abstract class ชื่อ <code>Common</code> ที่ประกาศ primary key ไว้</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">[&lt;AbstractClass&gt;]</span></span><br><span class="line"><span class="class"><span class="keyword">type</span> <span class="title">Common</span></span>() =</span><br><span class="line">    <span class="annotation">[&lt;Key&gt;]</span></span><br><span class="line">    <span class="keyword">member</span> <span class="keyword">val</span> Id = <span class="number">0</span> <span class="keyword">with</span> get, set</span><br><span class="line"><span class="class"><span class="keyword">type</span> <span class="title">QUser</span></span>() =</span><br><span class="line">    <span class="keyword">inherit</span> Common()</span><br><span class="line">    <span class="keyword">member</span> <span class="keyword">val</span> FirstName = <span class="string">""</span> <span class="keyword">with</span> set,get</span><br><span class="line">    <span class="keyword">member</span> <span class="keyword">val</span> LastName = <span class="string">""</span> <span class="keyword">with</span> set,get</span><br><span class="line">    <span class="keyword">member</span> <span class="keyword">val</span> Position = <span class="string">""</span> <span class="keyword">with</span> set,get</span><br><span class="line">    <span class="keyword">member</span> <span class="keyword">val</span> Email = <span class="string">""</span> <span class="keyword">with</span> set,get</span><br></pre></td></tr></table></figure>
<h2 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h2><p>Context ใน EF ใช้เป็น interface สำหรับ <code>insert</code> <code>update</code> <code>delete</code> และ  <code>query</code> ข้อมูล โดยการประกาศ context ต้อง inherit class ชื่อ <code>DbContext</code></p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">type</span> <span class="title">AppContext</span></span>(connection:string) =</span><br><span class="line">    <span class="keyword">inherit</span> DbContext(connection)</span><br><span class="line">    <span class="annotation">[&lt;DefaultValue&gt;]</span></span><br><span class="line">    <span class="keyword">val</span> <span class="keyword">mutable</span> <span class="keyword">private</span> users: DbSet&lt;QUser&gt;</span><br><span class="line">    <span class="keyword">member</span> this.Users</span><br><span class="line">        <span class="keyword">with</span> get() = this.users</span><br><span class="line">        <span class="keyword">and</span> set v = this.users &lt;- v</span><br></pre></td></tr></table></figure>
<p><code>AppContext</code> มี parameter 1 ตัวชื่อ <code>connection</code> เพื่อใช้สำหรับส่งชื่อ <code>connection</code> ที่ระบุไว้ในไฟล์ <code>App.config</code></p>
<h2 id="Create_Schema"><a href="#Create_Schema" class="headerlink" title="Create Schema"></a>Create Schema</h2><p>เมื่อเขียน Entity class และ context ครบแล้ว ต่อไปคือการ generate ฐานข้อมูลให้ได้ table และ field ตรง ที่ตามที่ประกาศไว้ใน Entity class วิธีการคือ ให้เพิ่มโค้ด <code>Database.SetInitializer</code> ก่อนที่จะทำ operation ใด ๆ ก็ตามกับฐานข้อมูล</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Database.SetInitializer&lt;AppContext&gt;</span><br><span class="line">    (<span class="keyword">new</span> DropCreateDatabaseIfModelChanges&lt;AppContext&gt;());</span><br><span class="line"><span class="keyword">use</span> context = <span class="keyword">new</span> AppContext(<span class="string">"production"</span>)</span><br><span class="line"><span class="keyword">let</span> rs = context.Users.Where(<span class="keyword">fun</span> x -&gt; x.FirstName = <span class="string">""</span>).FirstOrDefault()</span><br></pre></td></tr></table></figure>
<p>จากตัวอย่างใช้วิธีส่งคำสั่ง <code>new DropCreateDatabaseIfModelChanges&lt;AppContext&gt;()</code> ซึ่งหมายความว่าให้ drop ฐานข้อมูลและสร้างใหม่ถ้าตรวจเจอว่า Entity class มีการแก้ไข</p>
<p>หลังจาก Generate schema เราสามารถ <code>insert</code> <code>update</code> ฐานข้อมูลได้โดยใช้ syntax แบบ LINQ method หรือผ่าน LINQ query ก็ได้ สำหรับ LINQ query จะมี syntax ที่แตกต่างจาก C# สามารถดูตัวอย่างได้ตามลิงค์ด้านล่างนี้</p>
<p>Links</p>
<ul>
<li><a href="http://fsprojects.github.io/FSharp.Linq.ComposableQuery/QueryExamples.html" target="_blank" rel="external">http://fsprojects.github.io/FSharp.Linq.ComposableQuery/QueryExamples.html</a></li>
</ul>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/fs/">fs</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <article id="post-csharp-fizz-buzz-using-reactive-extensions" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/03/csharp-fizz-buzz-using-reactive-extensions/">Fizz Buzz โดยใช้ Reactive Extensions</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2016/02/03/csharp-fizz-buzz-using-reactive-extensions/" class="article-date">
  <time datetime="2016-02-03T14:58:03.000Z" itemprop="datePublished">2016-02-03</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Tools"><a href="#Tools" class="headerlink" title="Tools"></a>Tools</h2><ul>
<li>paket - <a href="https://fsprojects.github.io/Paket" target="_blank" rel="external">https://fsprojects.github.io/Paket</a></li>
<li>xbuild - <a href="http://www.mono-project.com/docs/tools+libraries/tools/xbuild" target="_blank" rel="external">http://www.mono-project.com/docs/tools+libraries/tools/xbuild</a></li>
</ul>
<h2 id="Dependencies"><a href="#Dependencies" class="headerlink" title="Dependencies"></a>Dependencies</h2><p>ไลบรารี่ <a href="http://reactivex.io" target="_blank" rel="external">Reactive Extensions</a> ของ .Net ชื่อ <code>Rx-Main</code> เมื่อตั้งตั้งแล้วจะได้ dll ทั้งหมด 4 ไฟล์ คือ <code>System.Reactive.dll</code> <code>System.Reactive.Interfes.dll</code> <code>System.Reactive.Linq.dll</code> และ <code>System.Reactive.PlatformServices.dll</code> เราสามารถระบุ dependencies นี้ไว้ในไฟล์ <code>paket.dependencies</code></p>
<p>ไฟล์ <code>paket.dependencies</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> https://www.nuget.org/api/v2</span><br><span class="line">nuget Rx-Main</span><br></pre></td></tr></table></figure>
<p>ทำการติดตั้ง <code>Rx-Main</code> โดยใช้ paket ผ่านคำสั่งใช้คำสั่ง</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">paket install</span><br></pre></td></tr></table></figure>
<p>โปรแกรม paket จะดาวโหลด dll ทั้งหมดไว้ในโฟลเดอร์ packages</p>
<h2 id="Project"><a href="#Project" class="headerlink" title="Project"></a>Project</h2><p>เมื่อตั้งตั้ง dependencies ครบแล้วทำการสร้างไฟล์ project โดยตั้งชื่อว่า <code>FizzBuzz.xml</code> และระบุ dependencies และ <code>HintPath</code> ไว้ในแท็ก <code>ItemGroup</code></p>
<p>สำหรับไฟล์ <code>Program.cs</code> ที่เป็นโค้ดของโปรแกรมจะเก็บไว้ใน <code>ItemGroup</code> แยกอีกอัน</p>
<p>ไฟล์ <code>FizzBuzz.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">Project</span> <span class="attribute">ToolsVersion</span>=<span class="value">"12.0"</span> <span class="attribute">DefaultTargets</span>=<span class="value">"Build"</span> <span class="attribute">xmlns</span>=<span class="value">"http://schemas.microsoft.com/developer/msbuild/2003"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">Import</span> <span class="attribute">Project</span>=<span class="value">"$(MSBuildExtensionsPath)\$(MSBuildToolVersion)\Microsoft.Common.props"</span></span><br><span class="line">        <span class="attribute">Condition</span>=<span class="value">"Exists('$(MSBuildExtensionPath)\$(MSBuildToolsVersion)\Microsoft.Common.props')"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">ItemGroup</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">Reference</span> <span class="attribute">Include</span>=<span class="value">"System"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">Reference</span> <span class="attribute">Include</span>=<span class="value">"System.Core"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">Reference</span> <span class="attribute">Include</span>=<span class="value">"System.Reactive.Core"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">HintPath</span>&gt;</span>packages/Rx-Core/lib/net45/System.Reactive.Core.dll<span class="tag">&lt;/<span class="title">HintPath</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">Reference</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">Reference</span> <span class="attribute">Include</span>=<span class="value">"System.Reactive.Interfaces"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">HintPath</span>&gt;</span>packages/Rx-Interfaces/lib/net45/System.Reactive.Interfaces.dll<span class="tag">&lt;/<span class="title">HintPath</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">Reference</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">Reference</span> <span class="attribute">Include</span>=<span class="value">"System.Reactive.Linq"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">HintPath</span>&gt;</span>packages/Rx-Linq/lib/net45/System.Reactive.Linq.dll<span class="tag">&lt;/<span class="title">HintPath</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">Reference</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">Reference</span> <span class="attribute">Include</span>=<span class="value">"System.Reactive.PlatformServices"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">HintPath</span>&gt;</span>packages/Rx-PlatformServices/lib/net45/System.Reactive.PlatformServices.dll<span class="tag">&lt;/<span class="title">HintPath</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">Reference</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">ItemGroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">ItemGroup</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">Compile</span> <span class="attribute">Include</span>=<span class="value">"Program.cs"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">ItemGroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">Import</span> <span class="attribute">Project</span>=<span class="value">"$(MSBuildToolsPath)\Microsoft.CSharp.targets"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">Project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h2><p>ในโปรแกรมจะมี static เมธอดชื่อ <code>Generate</code> ข้างในมีการใช้ <code>Observable</code> ที่เป็น Reactive Extensions โดยมีการใช้ filter ทั้งหมด 4 ตัวคือ <code>dividedByThree</code> <code>dividedByFive</code> <code>dividedByThreeAndFive</code> และ <code>simpleNumbers</code> ในโปรแกรมมีการ compose filter ทั้งหมดรวมกันโดยใช้ฟังก์ชัน <code>Merge</code></p>
<p>ไฟล์ <code>Program.cs</code></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Reactive;</span><br><span class="line"><span class="keyword">using</span> System.Reactive.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Program</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IEnumerable&lt;<span class="keyword">string</span>&gt; <span class="title">Generate</span>(<span class="params"><span class="keyword">int</span> max</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> result = <span class="keyword">new</span> List&lt;<span class="keyword">string</span>&gt;();</span><br><span class="line">        <span class="keyword">if</span> (max &lt;= <span class="number">0</span>) &#123; <span class="keyword">return</span> result; &#125;</span><br><span class="line">        <span class="keyword">var</span> observable = Observable.Range(<span class="number">1</span>, max);</span><br><span class="line">        <span class="keyword">var</span> dividedByThree = observable.Where(i =&gt; i % <span class="number">3</span> == <span class="number">0</span>).Select(_ =&gt; <span class="string">"Fizz"</span>);</span><br><span class="line">        <span class="keyword">var</span> dividedByFive = observable.Where(i =&gt; i % <span class="number">5</span> == <span class="number">0</span>).Select(_ =&gt; <span class="string">"Buzz"</span>);</span><br><span class="line">        <span class="keyword">var</span> dividedByThreeAndFive = observable.Where(i =&gt; i % <span class="number">15</span> == <span class="number">0</span>).Select(_ =&gt; <span class="string">"FizzBuzz"</span>);</span><br><span class="line">        <span class="keyword">var</span> simpleNumbers = observable.Where(i =&gt; i % <span class="number">3</span> != <span class="number">0</span> &amp;&amp; i % <span class="number">5</span> != <span class="number">0</span>).Select(i =&gt; i.ToString());</span><br><span class="line">        <span class="keyword">var</span> specialCases = (dividedByThreeAndFive)</span><br><span class="line">            .Merge(dividedByThree)</span><br><span class="line">            .Merge(dividedByFive);</span><br><span class="line">        simpleNumbers.Merge(specialCases).Subscribe(s =&gt; result.Add(s));</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params">String[] args</span>) </span>&#123;</span><br><span class="line">        Generate(<span class="number">100</span>).ToList().ForEach(Console.WriteLine);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Build"><a href="#Build" class="headerlink" title="Build"></a>Build</h2><p>คอมไพล์โค้ดโดยใช้ <code>xbuild</code> ผ่านคำสั่ง</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xbuild FizzBuzz.xml</span><br></pre></td></tr></table></figure>
<p><code>xbuild</code> จะสร้างไฟล์ <code>FizzBuzz.exe</code> เก็บไว้ในโพลเดอร์ <code>bin/Debug</code></p>
<h3 id="Run"><a href="#Run" class="headerlink" title="Run"></a>Run</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mono bin/Debug/FizzBuzz.exe</span><br></pre></td></tr></table></figure>
<p>Links</p>
<ul>
<li><a href="http://blog.drorhelper.com/2015/02/fizzbuzz-tdd-kata-using-reactive.html" target="_blank" rel="external">http://blog.drorhelper.com/2015/02/fizzbuzz-tdd-kata-using-reactive.html</a></li>
</ul>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cs/">cs</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <article id="post-csharp-string-concat-and-string-builder" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/02/csharp-string-concat-and-string-builder/">+ กับ StringBuilder</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2016/02/02/csharp-string-concat-and-string-builder/" class="article-date">
  <time datetime="2016-02-02T04:04:13.000Z" itemprop="datePublished">2016-02-02</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Concat_String__u0E14_u0E49_u0E27_u0E22_u0E40_u0E04_u0E23_u0E37_u0E48_u0E2D_u0E07_u0E2B_u0E21_u0E32_u0E22_+"><a href="#Concat_String__u0E14_u0E49_u0E27_u0E22_u0E40_u0E04_u0E23_u0E37_u0E48_u0E2D_u0E07_u0E2B_u0E21_u0E32_u0E22_+" class="headerlink" title="Concat String ด้วยเครื่องหมาย +"></a>Concat String ด้วยเครื่องหมาย +</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DateTime start = DateTime.Now;</span><br><span class="line"><span class="keyword">string</span> x = <span class="string">""</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line"> x += <span class="string">"!"</span>;</span><br><span class="line">&#125;</span><br><span class="line">DateTime end = DateTime.Now;</span><br><span class="line">Console.WriteLine (<span class="string">"Time taken: &#123;0&#125;"</span>, end-start);</span><br></pre></td></tr></table></figure>
<p>เนื่องจาก <code>string</code> เป็น immutable type ทุกครั้งที่ <code>x += &quot;!&quot;</code> ทำงานจะมีการสร้าง <code>string</code> ขึ้นใหม่ โดยคัดลอก <code>string</code> เดิมต่อกับเครื่องหมาย <code>!</code> ไปเก็บใน memory ที่มีการ allocate ขึ้นใหม่ จากโค้ดข้างบนจะมีการคัดลอก <code>string</code> ถึง 100,000 ครั้ง แต่ละครั้งจะใช้เวลามากขึ้นเรื่อยๆ เนื่องจากจากขนาดของ <code>string</code> ยาวขึ้น</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Time taken: <span class="number">00</span>:<span class="number">00</span>:<span class="number">09.3561040</span></span><br></pre></td></tr></table></figure>
<h2 id="Concat_String__u0E14_u0E49_u0E27_u0E22_StringBuilder"><a href="#Concat_String__u0E14_u0E49_u0E27_u0E22_StringBuilder" class="headerlink" title="Concat String ด้วย StringBuilder"></a>Concat String ด้วย StringBuilder</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DateTime start = DateTime.Now;</span><br><span class="line">StringBuilder builder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">    builder.Append(<span class="string">"!"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">string</span> x = builder.ToString();</span><br><span class="line">DateTime end = DateTime.Now;</span><br><span class="line">Console.WriteLine (<span class="string">"Time taken: &#123;0&#125;"</span>, end-start);</span><br></pre></td></tr></table></figure>
<p><code>StringBuilder</code> จะมี buffer อยู่ภายใน เมื่อมีการการต่อ string ด้วยฟังก์ชัน <code>Append</code> จะไม่จำเป็นต้องจอง memory ใหม่ทุกครั้ง แต่จะเกิดขึ้นเมื่อ memory หรือ buffer ที่มีอยู่ไม่พอ โดยจะเพิ่มขนาดของ buffer เป็นสองเท่าของขนาดเดิม จากโค้ดทั้งสองแบบ การใช้ <code>StringBuilder</code> จึงให้ประสิทธิภาพที่ดีกว่า</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Time taken: <span class="number">00</span>:<span class="number">00</span>:<span class="number">00.0527960</span></span><br></pre></td></tr></table></figure>
<p>Links</p>
<ul>
<li><a href="http://jonskeet.uk/csharp/stringbuilder.html" target="_blank" rel="external">http://jonskeet.uk/csharp/stringbuilder.html</a></li>
</ul>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cs/">cs</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <article id="post-csharp-user-defined-conversion" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/31/csharp-user-defined-conversion/">User-Defined Conversion ใน C#</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2016/01/31/csharp-user-defined-conversion/" class="article-date">
  <time datetime="2016-01-30T17:09:02.000Z" itemprop="datePublished">2016-01-31</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Implicit__u0E01_u0E31_u0E1A_Explicit_Conversion"><a href="#Implicit__u0E01_u0E31_u0E1A_Explicit_Conversion" class="headerlink" title="Implicit กับ Explicit Conversion"></a>Implicit กับ Explicit Conversion</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">float</span> f = <span class="number">105.5</span>f;</span><br><span class="line"><span class="keyword">double</span> d = f;</span><br></pre></td></tr></table></figure>
<p><code>float</code> <code>f</code> สามารถแปลงเป็น <code>double</code> <code>d</code> ผ่านการ assign ด้วยเครื่องหมาย <code>=</code> แบบอัตโนมัติ การ convert type แบบนี้เรียกว่า implicit conversion</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">double</span> d = <span class="number">305.5</span>;</span><br><span class="line"><span class="keyword">float</span> f = (<span class="keyword">float</span>) d;</span><br></pre></td></tr></table></figure>
<p>ในทางตรงกันข้าม เราไม่สามารถแปลง <code>double</code> <code>d</code> เป็น <code>float</code> <code>f</code> ได้โดยตรง ต้องใช้ operator cast โดยระบุ <code>float</code> เป็น parameter เราเรียก convert ที่ต้องระบุ type ปลายทางว่า explicit conversion</p>
<h2 id="User-Defined_Conversion"><a href="#User-Defined_Conversion" class="headerlink" title="User-Defined Conversion"></a>User-Defined Conversion</h2><p>เนื่องจาก <code>float</code> และ <code>double</code> เป็น <code>build-in</code> <code>type</code> เราจึงสามารถใช้คุณบัติ <code>implict</code> และ <code>explict conversion</code> ที่มีอยู่</p>
<p>ในกรณีที่ประกาศ type ใหม่ เราสามารถเขียน operator สำหรับ convert type โดยใช้ keyword <code>implicit</code> และ <code>explicit</code> โดย operator ต้องประกาศเป็น <code>public</code> <code>static</code> เสมอ</p>
<h4 id="Implicit"><a href="#Implicit" class="headerlink" title="Implicit"></a>Implicit</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">MagicNumber</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> Number &#123; <span class="keyword">set</span>; <span class="keyword">get</span>;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">implicit</span> <span class="keyword">operator</span> <span class="title">MagicNumber</span>(<span class="params"><span class="keyword">int</span> <span class="keyword">value</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MagicNumber &#123; Number = <span class="keyword">value</span> &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>จากตัวอย่าง ในคลาส <code>MagicNumber</code> มีการใช้ keyword <code>implicit</code> <code>operator</code> เพื่อ overload operator ชื่อ <code>MagicNumber</code> ซึ่งรับ <code>int</code> ตัวเดียวเป็น parameter สิ่งที่ได้จากการ overload ชื่อคลาสลักษณะนี้ จะทำให้ <code>MagicNumber</code> มีคุณสมบัติ <code>implicit conversion</code></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> i = <span class="number">3</span>;</span><br><span class="line">MagicNumber n = i;</span><br></pre></td></tr></table></figure>
<p>คุณสมบัติที่เพิ่มเข้ามาใหม่ ทำให้ <code>MagicNumber n</code> สามารถ assign ค่าใหม่ที่มี type <code>int</code> ได้โดยตรง</p>
<h4 id="Explicit"><a href="#Explicit" class="headerlink" title="Explicit"></a>Explicit</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">explicit</span> <span class="keyword">operator</span> <span class="title">int</span>(<span class="params">MagicNumber <span class="keyword">value</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">value</span>.Number;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>การเขียน <code>explict convertsion</code> ต่างจาก <code>implict convertsion</code> เล็กน้อย คือ เปลี่ยนจาก keyword <code>implicit</code> เป็น <code>explicit</code> เท่านั้น</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MagicNumber n = <span class="keyword">new</span> MagicNumber &#123; Number = <span class="number">2</span> &#125;;</span><br><span class="line"><span class="keyword">int</span> i = (<span class="keyword">int</span>) n;</span><br></pre></td></tr></table></figure>
<p>Links</p>
<ul>
<li><a href="https://msdn.microsoft.com/en-us/library/aa288476(v=vs.71).aspx" target="_blank" rel="external">https://msdn.microsoft.com/en-us/library/aa288476(v=vs.71).aspx</a></li>
<li><a href="http://rbwhitaker.wikidot.com/c-sharp-user-defined-conversions" target="_blank" rel="external">http://rbwhitaker.wikidot.com/c-sharp-user-defined-conversions</a></li>
</ul>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cs/">cs</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <article id="post-csharp-explicit-conversion" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/30/csharp-explicit-conversion/">Explicit conversion ใน C#</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2016/01/30/csharp-explicit-conversion/" class="article-date">
  <time datetime="2016-01-29T18:06:18.000Z" itemprop="datePublished">2016-01-30</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>การแปลง type ใน C# มีหลายแบบ</p>
<ul>
<li>Implicit conversion - แปลงแบบอัติโนมัติโดย compiler</li>
<li>Explicit conversion (cast) - แปลงโดยใช้ keyword <code>as</code> หรือ ใช้ operator cast</li>
<li>User-define conversion - เขียน method สำหรับแปลง type ขึ้นเอง</li>
<li>Helper class - ใช้ helper ที่มีอยู่แล้ว เช่น คลาส <code>Convert</code></li>
</ul>
<h2 id="Explicit_conversion"><a href="#Explicit_conversion" class="headerlink" title="Explicit conversion"></a>Explicit conversion</h2><h4 id="u0E43_u0E0A_u0E49_cast"><a href="#u0E43_u0E0A_u0E49_cast" class="headerlink" title="ใช้ cast"></a>ใช้ cast</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span> x = ...;</span><br><span class="line"><span class="keyword">if</span> (x <span class="keyword">is</span> String) &#123;</span><br><span class="line">    <span class="keyword">var</span> str = (String) x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Cast มักใช้คู่กับ <code>is</code> เพื่อทำ type checking สำหรับกัน error  <code>InvalidCastException</code> ในกรณีที่ CLR ไม่สามารถแปลง object ให้เป็น type ที่ต้องการได้</p>
<h4 id="u0E43_u0E0A_u0E49_as"><a href="#u0E43_u0E0A_u0E49_as" class="headerlink" title="ใช้ as"></a>ใช้ <code>as</code></h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = x <span class="keyword">as</span> <span class="keyword">string</span>;</span><br><span class="line"><span class="keyword">if</span> (str != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="comment">// Use str</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>การแปลง type โดยใช้ <code>as</code> จะช่วยลดขั้นตอน type checking และไม่มีทาง error เนื่องจาก operator <code>as</code> จะคืนค่า <code>null</code> ในกรณีที่ไม่สามารถแปลง type จะต่างจาก cast ที่จะเกิด error <code>InvalidCastException</code> ข้อจำกัดของ <code>as</code> คือใช้ได้กับ type ที่เป็น <code>Nullable</code> เท่านั้น</p>
<h4 id="u0E43_u0E0A_u0E49_as__u0E43_u0E19_for"><a href="#u0E43_u0E0A_u0E49_as__u0E43_u0E19_for" class="headerlink" title="ใช้ as ใน for"></a>ใช้ <code>as</code> ใน <code>for</code></h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> str = x <span class="keyword">as</span> <span class="keyword">string</span>; str != <span class="keyword">null</span>; str = <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="comment">// Use str</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>เราสามารถใช้ <code>as</code> ว่างไว้ใน expression for เพื่อกันตังแปร <code>str</code> ให้อยู่ใน scope วิธีนี้เป็น programming trick ที่ทำให้โค้ดอ่านยาก จึงไม่นิยมใช้</p>
<h2 id="Performance"><a href="#Performance" class="headerlink" title="Performance"></a>Performance</h2><p>การ convert type มีผลกับประสิทธิภาพของโปรแกรม ถ้าไม่สามารถหลีกเลี่ยงได้ ก็ควรทำให้น้อยที่สุด การใช้ <code>as</code> แทน cast จะช่วยลดจำนวน conversion ได้หนึ่งครั้ง เนื่องจากการทำ type checking ด้วย <code>is</code> จะเกิด type conversion เช่นกัน</p>
<p>อย่างไรก็ตามการใช้ as กับข้อมูลประเภท <code>Nullable</code> ของ value type เช่น <code>int?</code> จะ drop performance ของโปรแกรมมากกว่าการใช้ <code>is</code> + cast อย่างมีนัยยสำคัญ เนื่องจากการแปลง value type ให้เป็น <code>Nullable</code> จะมี operator อื่นเพิ่มเข้ามา</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">Test</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> Size = <span class="number">30000000</span>;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">object</span>[] values = <span class="keyword">new</span> <span class="keyword">object</span>[Size];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Size - <span class="number">2</span>; i += <span class="number">3</span>) &#123;</span><br><span class="line">            values[i] = <span class="keyword">null</span>;</span><br><span class="line">            values[i+<span class="number">1</span>] = <span class="string">""</span>;</span><br><span class="line">            values[i+<span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        FindSumWithCast(values);</span><br><span class="line">        FindSumWithAs(values);</span><br><span class="line">        FindSumWithLinq(values);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">FindSumWithCast</span>(<span class="params"><span class="keyword">object</span>[] values</span>) </span>&#123;</span><br><span class="line">        Stopwatch sw = Stopwatch.StartNew();</span><br><span class="line">        <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">object</span> o <span class="keyword">in</span> values) &#123;</span><br><span class="line">            <span class="keyword">if</span> (o <span class="keyword">is</span> <span class="keyword">int</span>) &#123;</span><br><span class="line">                <span class="keyword">int</span> x = (<span class="keyword">int</span>) o;</span><br><span class="line">                sum += x;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        sw.Stop();</span><br><span class="line">        Console.WriteLine(<span class="string">"Cast: &#123;0&#125; : &#123;1&#125;"</span>, sum, (<span class="keyword">long</span>) sw.ElapsedMilliseconds);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">FindSumWithAs</span>(<span class="params"><span class="keyword">object</span>[] values</span>) </span>&#123;</span><br><span class="line">        Stopwatch sw = Stopwatch.StartNew();</span><br><span class="line">        <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">object</span> o <span class="keyword">in</span> values) &#123;</span><br><span class="line">            <span class="keyword">int</span>? x = o <span class="keyword">as</span> <span class="keyword">int</span>?;</span><br><span class="line">            <span class="keyword">if</span> (x.HasValue) &#123;</span><br><span class="line">                sum += x.Value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        sw.Stop();</span><br><span class="line">        Console.WriteLine(<span class="string">"As: &#123;0&#125; : &#123;1&#125;"</span>, sum, (<span class="keyword">long</span>) sw.ElapsedMilliseconds);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">FindSumWithLinq</span>(<span class="params"><span class="keyword">object</span>[] values</span>) </span>&#123;</span><br><span class="line">        Stopwatch sw = Stopwatch.StartNew();</span><br><span class="line">        <span class="keyword">int</span> sum = values.OfType&lt;<span class="keyword">int</span>&gt;().Sum();</span><br><span class="line">        sw.Stop();</span><br><span class="line">        Console.WriteLine(<span class="string">"LINQ: &#123;0&#125; : &#123;1&#125;"</span>, sum, (<span class="keyword">long</span>) sw.ElapsedMilliseconds);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>จากตัวอย่าง <code>FindSumWithCast</code> การ cast แบบปกติ สามารถ <code>unbox</code> object ให้เป็น type <code>int</code> ได้โดยตรง ส่วน <code>FindWithAs</code> จะต้อง <code>unbox</code> ให้เป็น <code>Nullable int</code> หรือ <code>int?</code> ซึ่งจะมี internal operation เกิดขึ้นในฟังก์ชั่น <code>JIT_Unbox_Nullable</code> ของ <code>JIT</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Cast: <span class="number">10000000</span> : <span class="number">74</span></span><br><span class="line">As: <span class="number">10000000</span> : <span class="number">316</span></span><br><span class="line">LINQ: <span class="number">10000000</span> : <span class="number">913</span></span><br></pre></td></tr></table></figure>
<p>ผลการรัน ในกรณีที่ใช้ cast ให้ประสิทธิภาพที่ดีกว่าการใช้ <code>as</code> ถึงแม้จะมี type conversion เกิดขึ้นสองครั้งก็ตาม</p>
<p>Links</p>
<ul>
<li><a href="https://msdn.microsoft.com/en-us/library/ms173105.aspx" target="_blank" rel="external">https://msdn.microsoft.com/en-us/library/ms173105.aspx</a></li>
<li><a href="http://stackoverflow.com/questions/1583050/performance-surprise-with-as-and-nullable-types" target="_blank" rel="external">http://stackoverflow.com/questions/1583050/performance-surprise-with-as-and-nullable-types</a></li>
<li><a href="http://ericlippert.com/2015/10/14/casts-and-type-parameters-do-not-mix" target="_blank" rel="external">http://ericlippert.com/2015/10/14/casts-and-type-parameters-do-not-mix</a></li>
</ul>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cs/">cs</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <article id="post-fsharp-fizz-buzz" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/24/fsharp-fizz-buzz/">Fizz Buzz in F#</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2016/01/24/fsharp-fizz-buzz/" class="article-date">
  <time datetime="2016-01-24T09:46:08.000Z" itemprop="datePublished">2016-01-24</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Fuzz_Buzz"><a href="#Fuzz_Buzz" class="headerlink" title="Fuzz Buzz"></a>Fuzz Buzz</h2><p>Fizz Buzz เป็นโจทย์ที่นิยมใช้สำหรับ ทดสอบการเขียนโปรแกรม กฎคือ ให้เขียนโปรแกรมที่รันเลขตั้งแต่ 1 - 100 โดย</p>
<ol>
<li>ถ้าเลขนั้นหาร 3 ลงตัวให้พิมพ์ <code>Fizz</code></li>
<li>ถ้าเลขนั้นหาร 5 ลงตัวให้พิมพ์ <code>Buzz</code></li>
<li>และถ้าเลขนั้นหารทั้ง 3 และ 5 ลงตัวให้พิมพ์ <code>FizzBuzz</code></li>
</ol>
<p>ใน F# สามารถแก้ปัญหานี้ได้หลายวิธี วิธีที่ง่ายสุดคือใช้ Pattern matching อีกวิธีคือใช้ Active pattern ซึ่งจะทำให้โค้ดอ่านง่ายขึ้น ส่วนวิธีสุดท้ายที่ยากสุดคือ ใช้ Computation expression</p>
<h2 id="Pattern_matching"><a href="#Pattern_matching" class="headerlink" title="Pattern matching"></a>Pattern matching</h2><p>Pattern matching แบบแรกคือ ใช้วิธีีคำนวณตัวเลขทีตำแหน่ง matching case โดยใช้ when guard</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fizzBuzz number =</span><br><span class="line">    <span class="keyword">match</span> number <span class="keyword">with</span></span><br><span class="line">    | n <span class="keyword">when</span> n % <span class="number">15</span> = <span class="number">0</span> -&gt; <span class="string">"FizzBuzz"</span></span><br><span class="line">    | n <span class="keyword">when</span> n % <span class="number">3</span> = <span class="number">0</span> -&gt; <span class="string">"Fizz"</span></span><br><span class="line">    | n <span class="keyword">when</span> n % <span class="number">5</span> = <span class="number">0</span> -&gt; <span class="string">"Buzz"</span></span><br><span class="line">    | n -&gt; sprintf <span class="string">"%d"</span> n</span><br><span class="line"></span><br><span class="line">[<span class="number">1.</span><span class="number">.100</span>]</span><br><span class="line">|&gt; List.map fizzBuzz</span><br><span class="line">|&gt; List.iter (printfn <span class="string">"%s"</span>)</span><br></pre></td></tr></table></figure>
<p>หรือคำนวนในประโยค <code>match ... with</code></p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fizzBuzz i =</span><br><span class="line">    <span class="keyword">match</span> i % <span class="number">3</span>, i % <span class="number">5</span> <span class="keyword">with</span></span><br><span class="line">    | <span class="number">0</span>, <span class="number">0</span> -&gt; <span class="string">"FizzBuzz"</span></span><br><span class="line">    | <span class="number">0</span>, _ -&gt; <span class="string">"Fizz"</span></span><br><span class="line">    | _, <span class="number">0</span> -&gt; <span class="string">"Buzz"</span></span><br><span class="line">    | _ -&gt; string i</span><br><span class="line">[<span class="number">1.</span><span class="number">.100</span>] |&gt; Seq.map fizzBuzz0 |&gt; Seq.iter (printfn <span class="string">"%s"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="Partial_active_pattern"><a href="#Partial_active_pattern" class="headerlink" title="Partial active pattern."></a>Partial active pattern.</h2><p>ใช้ Partial active pattern สองตัว คือ <code>P3</code> และ <code>P5</code></p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> (|P3|_|) i = <span class="keyword">if</span> i % <span class="number">3</span> = <span class="number">0</span> <span class="keyword">then</span> Some i <span class="keyword">else</span> None</span><br><span class="line"><span class="keyword">let</span> (|P5|_|) i = <span class="keyword">if</span> i % <span class="number">5</span> = <span class="number">0</span> <span class="keyword">then</span> Some i <span class="keyword">else</span> None</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> f = <span class="keyword">function</span></span><br><span class="line">  | P3 _ &amp; P5 _ -&gt; printfn <span class="string">"FizzBuzz"</span></span><br><span class="line">  | P3 _        -&gt; printfn <span class="string">"Fizz"</span></span><br><span class="line">  | P5 _        -&gt; printfn <span class="string">"Buzz"</span></span><br><span class="line">  | x           -&gt; printfn <span class="string">"%d"</span> x</span><br><span class="line"></span><br><span class="line">Seq.iter f &#123;<span class="number">1.</span><span class="number">.100</span>&#125;</span><br><span class="line"><span class="comment">//or</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1.</span><span class="number">.100</span> <span class="keyword">do</span> f i</span><br></pre></td></tr></table></figure>
<p>หรือใช้ Partial case เดียว คือ <code>DivisibleBy</code> ซึ่งเป็น Optimize version ของแบบแรก</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> (|DivisibleBy|_|) divisor i =</span><br><span class="line">    <span class="keyword">if</span> i % divisor = <span class="number">0</span> <span class="keyword">then</span> Some () <span class="keyword">else</span> None</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1.</span><span class="number">.100</span> <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">match</span> i <span class="keyword">with</span></span><br><span class="line">    | DivisibleBy <span class="number">3</span> &amp; DivisibleBy <span class="number">5</span> -&gt; printfn <span class="string">"FizzBuzz"</span></span><br><span class="line">    | DivisibleBy <span class="number">3</span> -&gt; printfn <span class="string">"Fizz"</span></span><br><span class="line">    | DivisibleBy <span class="number">5</span> -&gt; printfn <span class="string">"Buzz"</span></span><br><span class="line">    | _ -&gt; printfn <span class="string">"%d"</span> i</span><br></pre></td></tr></table></figure>
<h2 id="Computation_expression"><a href="#Computation_expression" class="headerlink" title="Computation expression"></a>Computation expression</h2><p>วิธีที่ยากสุด คือ เขียนด้วย Computation expression</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">type</span> <span class="title">M</span>&lt;<span class="title">'T</span>&gt;  </span>= M <span class="keyword">of</span> <span class="attribute">'T</span></span><br><span class="line"><span class="class"><span class="keyword">type</span> <span class="title">MonadBuilder</span></span>() =</span><br><span class="line">    <span class="keyword">member</span> this.Return x = M x</span><br><span class="line"><span class="keyword">let</span> m = MonadBuilder()</span><br><span class="line"><span class="keyword">let</span> fizz = <span class="keyword">function</span></span><br><span class="line">    | x <span class="keyword">when</span> x % <span class="number">3</span> = <span class="number">0</span>  -&gt; m &#123; <span class="keyword">return</span> x, <span class="string">"Fizz"</span>&#125;</span><br><span class="line">    | x -&gt; m &#123; <span class="keyword">return</span> x, x.ToString() &#125;</span><br><span class="line"><span class="keyword">let</span> buzz = <span class="keyword">function</span></span><br><span class="line">    | M (x,s) <span class="keyword">when</span> x % <span class="number">5</span> = <span class="number">0</span> -&gt; m &#123; <span class="keyword">return</span> x, s + <span class="string">"Buzz"</span> &#125;</span><br><span class="line">    | M (x,<span class="string">""</span>) -&gt; m &#123; <span class="keyword">return</span> x, x.ToString() &#125;</span><br><span class="line">    | M (x,s) -&gt; m &#123; <span class="keyword">return</span> x, s &#125;</span><br><span class="line"></span><br><span class="line">[<span class="number">1.</span><span class="number">.100</span>]</span><br><span class="line">|&gt; List.map(fizz &gt;&gt; buzz)</span><br><span class="line">|&gt; List.iter(<span class="keyword">fun</span> (M (_,s)) -&gt; printfn <span class="string">"%A"</span> s)</span><br></pre></td></tr></table></figure>
<p>Links</p>
<ul>
<li><a href="http://stackoverflow.com/questions/2422697/how-to-code-fizzbuzz-in-f" target="_blank" rel="external">http://stackoverflow.com/questions/2422697/how-to-code-fizzbuzz-in-f</a></li>
<li><a href="http://zecl.hatenablog.com/entry/20110711/p1" target="_blank" rel="external">http://zecl.hatenablog.com/entry/20110711/p1</a></li>
<li><a href="https://twitter.com/CallMeKohei/status/673677619250913280" target="_blank" rel="external">https://twitter.com/CallMeKohei/status/673677619250913280</a></li>
</ul>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/fs/">fs</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <article id="post-fsharp-active-pattern" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/23/fsharp-active-pattern/">F# Active Patterns</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2016/01/23/fsharp-active-pattern/" class="article-date">
  <time datetime="2016-01-23T12:27:15.000Z" itemprop="datePublished">2016-01-23</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>F# มี syntax พิเศษที่ช่วยให้เขียน Pattern matching ได้ง่ายขึ้น โดยใช้โครงสร้างคล้าย ๆ กับ <a href="https://msdn.microsoft.com/en-us/library/dd233226.aspx" target="_blank" rel="external">Union</a> ใช้วิธีประกาศ Test case ที่ต้องการในเครื่องหมาย <code>(||)</code> Active pattern มีหลายแบบ ขึ้นอยู่กับจำนวน Case ที่ใช้</p>
<h2 id="Single-Case_Active_Patterns"><a href="#Single-Case_Active_Patterns" class="headerlink" title="Single-Case Active Patterns"></a>Single-Case Active Patterns</h2><p>เป็น Active pattern ที่มี Case เดียวและมี Input เพียงตัวเดียว Active pattern แบบนี้ต้อง Return ผลลัพทธ์เสมอ</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> (|Remainder2|) x = x % <span class="number">2</span></span><br><span class="line"><span class="keyword">let</span> checkNumber = <span class="keyword">function</span></span><br><span class="line">    | Remainder2 <span class="number">1</span> -&gt; <span class="string">"even number"</span></span><br><span class="line">    | Remainder2 <span class="number">0</span> -&gt; <span class="string">"odd number"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// "even number"</span></span><br><span class="line">checkNumber <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>จากตัวอย่าง <code>Remainder2</code> เป็น Pattern ที่มี Case โดยคำนวณค่า Mod จาก Input ที่ส่งเข้ามา</p>
<h2 id="Partial-Case_Active_Pattern"><a href="#Partial-Case_Active_Pattern" class="headerlink" title="Partial-Case Active Pattern"></a>Partial-Case Active Pattern</h2><p>เป็น Active patten ที่ Return ผลลัพท์เป็น Option และสามารถใช้ Pattern หลายตัวมาประกอบกัน เมื่อต้องการ Matching</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> (|LessThen10|_|) x = <span class="keyword">if</span> x &lt; <span class="number">10</span> <span class="keyword">then</span> Some x <span class="keyword">else</span> None</span><br><span class="line"><span class="keyword">let</span> (|Btw10And20|_|) x = <span class="keyword">if</span> x &gt;= <span class="number">10</span> &amp;&amp; x &lt; <span class="number">20</span> <span class="keyword">then</span> Some x <span class="keyword">else</span> None</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> checkNumber x =</span><br><span class="line">    <span class="keyword">match</span> x <span class="keyword">with</span></span><br><span class="line">    | LessThen10 a -&gt; <span class="string">"less then 10"</span></span><br><span class="line">    | Btw10And20 a -&gt; <span class="string">"between 10 and 20"</span></span><br><span class="line">    | _ -&gt; <span class="string">"that's a big number"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// "that's big number"</span></span><br><span class="line">checkNumber <span class="number">20</span></span><br></pre></td></tr></table></figure>
<p><code>LessThen10</code> และ <code>Btw10And20</code> เป็น Partial pattern ที่ทดสอบว่าตัวเลขอยู่ใน Range ของตัวเองหรือไม่ สังเกตว่า Output ที่ได้จะเป็น Option ซึ่งในกรณีที่ Return ค่าเป็น None แสดงว่า Input ที่รับเข้ามาอยู่นอก Range ในกรณีที่ Input ที่รับมาไม่อยู่ใน Range ใดเลย เมื่อทำการ Matching ก็จะถูก Evaluate เข้า Case default หรือ <code>_</code> นั่นเอง</p>
<h2 id="Multicase_Active_Pattern"><a href="#Multicase_Active_Pattern" class="headerlink" title="Multicase Active Pattern"></a>Multicase Active Pattern</h2><p>เป็น Pattern matching ที่มีหลาย Case โดย Pattern แบบนี้ต้อง Return choice ตามจำนวนตาม Case ที่ประกาศไว้ใน <code>(||)</code></p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> (|Q1|Q2|Q3|Q4|) (date:System.DateTime) =</span><br><span class="line">    <span class="keyword">let</span> month = date.Month</span><br><span class="line">    <span class="keyword">match</span> month <span class="keyword">with</span></span><br><span class="line">    |<span class="number">1</span>|<span class="number">2</span>|<span class="number">3</span> -&gt; Q1 month</span><br><span class="line">    |<span class="number">4</span>|<span class="number">5</span>|<span class="number">6</span> -&gt; Q2 month</span><br><span class="line">    |<span class="number">7</span>|<span class="number">8</span>|<span class="number">9</span> -&gt; Q3 month</span><br><span class="line">    |_ -&gt; Q4 month</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> newYearResolution date =</span><br><span class="line">    <span class="keyword">match</span> date <span class="keyword">with</span></span><br><span class="line">    | Q1 _ -&gt; <span class="string">"read"</span></span><br><span class="line">    | Q2 _ -&gt; <span class="string">"write"</span></span><br><span class="line">    | Q3 _ -&gt; <span class="string">"execute"</span></span><br><span class="line">    | Q4 _ -&gt; <span class="string">"sleep"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// "sleep"</span></span><br><span class="line">newYearResolution &lt;| DateTime(<span class="number">2015</span>,<span class="number">10</span>,<span class="number">10</span>)</span><br></pre></td></tr></table></figure>
<p><code>(|Q1|Q2|Q3|Q4|)</code> เป็น Pattern ที่ใช้หา Quarter ของ DateTime ที่รับเข้ามา สังเกตว่าฟังก์ชัน Match จะต้อง Return Q1 - Q4 ให้ครบ</p>
<h2 id="Parameterized_Active_Pattern"><a href="#Parameterized_Active_Pattern" class="headerlink" title="Parameterized Active Pattern"></a>Parameterized Active Pattern</h2><p>เป็น Pattern ที่สามารถเพิ่ม Parameter ตัวที่สอง ซึ่งแตกต่างจาก Pattern แบบอื่นที่สามารถมี Parameter ตัวแรกเพียงตัวเดียว</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span>(|Divisible|_|) x y =</span><br><span class="line">    <span class="keyword">if</span> y % x = <span class="number">0</span> <span class="keyword">then</span> Some Divisible</span><br><span class="line">    <span class="keyword">else</span> None</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> f2 = <span class="keyword">function</span></span><br><span class="line">    | Divisible <span class="number">2</span> &amp; Divisible <span class="number">3</span> -&gt; <span class="string">"divisible by 6"</span></span><br><span class="line">    | _-&gt; <span class="string">"other"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// "divisible by 6"</span></span><br><span class="line">f2 <span class="number">12</span></span><br></pre></td></tr></table></figure>
<p><code>Divisible</code> เป็น Pattern ที่รับ Parameter สองตัว คือ <code>x</code> และ <code>y</code> จะเห็นว่าขั้นตอนการเรียกใช้ คือ ในฟังก์ชั่น <code>f2</code> มีการส่ง Parameter ตัวแรก คือ <code>2</code> และ <code>3</code> จากนั้นตอนเรียกใช้ฟังก์ชั่น <code>f2</code> มีการส่ง Parameter ตัวที่สองคือ <code>12</code></p>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/fs/">fs</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <article id="post-fsharp-inline-evaluation-with-light-table" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/22/fsharp-inline-evaluation-with-light-table/">เขียน F# แบบ Inline evaluation ด้วย Light Table</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2016/01/22/fsharp-inline-evaluation-with-light-table/" class="article-date">
  <time datetime="2016-01-22T12:38:28.000Z" itemprop="datePublished">2016-01-22</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>โปรแกรม <a href="http://lighttable.com" target="_blank" rel="external">Light Table</a> เป็น Text editor ที่สามารถเขียนโปรแกรมแบบ Inline evaluation คือ เราสามารถพิมพ์โค้ดและสั่ง Execute คำสั่งในบรรทัดนั้น เพื่อดูผลลัพธ์ได้ทันที</p>
<p>ข้อดีของการเขียนโปรแกรมแบบนี้ คือ เราสามารถใช้ทดสอบโค้ดได้ง่าย ไม่ต้องใช้ IDE หรือเขียนโปรแกรมพิมพ์ผลลัพธ์ผ่าน Console  ที่มีความยุ่งยาก</p>
<h2 id="u0E40_u0E04_u0E23_u0E37_u0E48_u0E2D_u0E07_u0E21_u0E37_u0E2D_u0E17_u0E35_u0E48_u0E15_u0E49_u0E2D_u0E07_u0E43_u0E0A_u0E49"><a href="#u0E40_u0E04_u0E23_u0E37_u0E48_u0E2D_u0E07_u0E21_u0E37_u0E2D_u0E17_u0E35_u0E48_u0E15_u0E49_u0E2D_u0E07_u0E43_u0E0A_u0E49" class="headerlink" title="เครื่องมือที่ต้องใช้"></a>เครื่องมือที่ต้องใช้</h2><ol>
<li>โปรแกรม F# interactive fsharpi (Mac) / fsi (Windows)</li>
<li>โปรแกรม Light Table</li>
<li>F# plugin ของ Light Table</li>
</ol>
<h2 id="u0E15_u0E34_u0E14_u0E15_u0E31_u0E49_u0E07_fsharpi_/_fsi"><a href="#u0E15_u0E34_u0E14_u0E15_u0E31_u0E49_u0E07_fsharpi_/_fsi" class="headerlink" title="ติดตั้ง fsharpi / fsi"></a>ติดตั้ง fsharpi / fsi</h2><ul>
<li>Mac - <a href="http://fsharp.org/use/mac" target="_blank" rel="external">http://fsharp.org/use/mac</a></li>
<li>Windows - <a href="http://fsharp.org/use/windows" target="_blank" rel="external">http://fsharp.org/use/windows</a></li>
</ul>
<h2 id="u0E15_u0E34_u0E14_u0E15_u0E31_u0E49_u0E07_Light_Table"><a href="#u0E15_u0E34_u0E14_u0E15_u0E31_u0E49_u0E07_Light_Table" class="headerlink" title="ติดตั้ง Light Table"></a>ติดตั้ง Light Table</h2><ul>
<li>สามารถโหลดไฟล์ <a href="http://lighttable.com/" target="_blank" rel="external">Installer</a> จากเว็บไซต์ได้โดยตรง</li>
</ul>
<h2 id="u0E15_u0E34_u0E14_u0E15_u0E31_u0E49_u0E07_F_23_plugin"><a href="#u0E15_u0E34_u0E14_u0E15_u0E31_u0E49_u0E07_F_23_plugin" class="headerlink" title="ติดตั้ง F# plugin"></a>ติดตั้ง F# plugin</h2><p>หลังจากติดตั้ง Light Table สามารถติดตั้ง Plugin ผ่าน Plugin manager ตามขั้นตอนต่อไปนี้</p>
<ol>
<li>เปิดโปรแกรม Light Table</li>
<li><p>เปิดหน้าต่าง Plugin manager โดยการกดปุ่ม <code>Ctrl + Space</code> พิมพ์คำว่า <code>plugin</code> แล้วคลิกเลือก <code>Show plugin manager</code></p>
<p> <img src="/images/open-plugin-manager.png" alt=""></p>
</li>
<li><p>ในหน้า Plugin manager ให้ Search คำว่า <code>F#</code> แล้วคลิกปุ่ม Install ที่มุมด้านขวา</p>
<p> <img src="/images/install-plugin.png" alt=""></p>
</li>
</ol>
<h2 id="u0E01_u0E32_u0E23_u0E43_u0E0A_u0E49_u0E07_u0E32_u0E19"><a href="#u0E01_u0E32_u0E23_u0E43_u0E0A_u0E49_u0E07_u0E32_u0E19" class="headerlink" title="การใช้งาน"></a>การใช้งาน</h2><p>หนังจากติดตั้ง Plugin เราสามารถใช้งานได้ทันที่ ด้วยวิธีง่าย ๆ ดังนี้</p>
<ol>
<li>พิมพ์โคัด</li>
<li>Hightlight บรรทัดที่ต้องการ</li>
<li><p>กด <code>Ctrl + Enter</code> (Windows) / <code>Command + Enterl</code> (Mac)</p>
<p> <img src="/images/inline-evaluation.png" alt=""></p>
</li>
</ol>
<p>จากตัวอย่าง</p>
<ul>
<li>ถ้าบรรทัดที่เลือก return void โปรแกรมจะแสดงเครื่องหมายถูก</li>
<li>ส่วนบรรทัดที่ return ค่า โปรแกรมจะแสดงผลลัทธ์ที่ท้ายบรรทัด</li>
</ul>
<p>Links</p>
<ul>
<li>Light Table - <a href="http://lighttable.com" target="_blank" rel="external">http://lighttable.com</a></li>
<li>F# plugin - <a href="https://github.com/enricosada/LightTable-FSharp" target="_blank" rel="external">https://github.com/enricosada/LightTable-FSharp</a></li>
<li>Use F# on Windows - <a href="http://fsharp.org/use/windows" target="_blank" rel="external">http://fsharp.org/use/windows</a></li>
<li>Use F# on Mac - <a href="http://fsharp.org/use/mac" target="_blank" rel="external">http://fsharp.org/use/mac</a></li>
</ul>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/fs/">fs</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <nav id="page-nav">
        <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
      </nav>
    </section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 wk&nbsp;
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, theme by <a href="http://github.com/ppoffice">PPOffice</a>
    </div>
  </div>
</footer>
    

<script src="/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>
  </div>
</body>
</html>